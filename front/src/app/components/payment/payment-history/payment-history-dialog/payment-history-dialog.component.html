<mat-dialog-content>
    <!-- Sélection des groupes et séries -->
    <mat-form-field appearance="fill">
      <mat-label>{{ 'payment.history.fields.groups' | translate }}</mat-label>
      <mat-select [(ngModel)]="selectedGroup" (selectionChange)="loadSessionSeries()">
        <mat-option *ngFor="let group of studentGroups" [value]="group.id">
          {{ group.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" *ngIf="selectedGroup">
      <mat-label>{{ 'payment.history.fields.series' | translate }}</mat-label>
      <mat-select [(ngModel)]="selectedSeries" (selectionChange)="loadPaymentHistory()">
        <mat-option *ngFor="let series of sessionSeries" [value]="series.id">
          {{ series.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  
    <!-- Note de rattrapage -->
    <div *ngIf="selectedSeries && isCatchUpSeries" style="background-color: #ffebee; padding: 10px; margin: 10px 0; border-left: 4px solid red;">
      <p style="color: red; font-weight: bold; margin: 0;">
        {{ 'payment.history.catchUpNotice.title' | translate }}
      </p>
      <p style="color: #666; font-size: 0.9em; margin: 5px 0 0 0;">
        {{ 'payment.history.catchUpNotice.description' | translate }}
      </p>
    </div>

    <!-- Résumé de la série -->
    <div [ngClass]="{
        'summary-paid': seriesStatus === 'paid',
        'summary-partially-paid': seriesStatus === 'partiallyPaid',
        'summary-unpaid': seriesStatus === 'unpaid'
      }" class="series-summary" *ngIf="selectedSeries">
      <p><strong>{{ 'payment.history.labels.status' | translate }} :</strong> {{ 'payment.history.status.' + seriesStatus | translate }}</p>
      <p><strong>{{ isCatchUpSeries ? ('payment.history.labels.totalCatchUp' | translate) : ('payment.history.labels.total' | translate) }} :</strong> {{ seriesTotal | currency:'DA' }}</p>
      <p><strong>{{ 'payment.history.labels.paid' | translate }} :</strong> {{ seriesPaid | currency:'DA' }}</p>
      <p><strong>{{ 'payment.history.labels.remaining' | translate }} :</strong> {{ seriesRemaining | currency:'DA' }}</p>
    </div>

    <!-- Tableau des sessions et des paiements -->
    <table mat-table [dataSource]="paymentHistory" class="mat-elevation-z8">
      <!-- Session Column -->
      <ng-container matColumnDef="session">
        <th mat-header-cell *matHeaderCellDef>{{ 'payment.history.table.session' | translate }}</th>
        <td mat-cell *matCellDef="let payment" [ngClass]="{
          'row-paid': payment.status === 'paid',
          'row-partially-paid': payment.status === 'partiallyPaid',
          'row-unpaid': payment.status === 'unpaid'
        }"> {{ payment.sessionName }} </td>
      </ng-container>
  
      <!-- Payment Date Column -->
      <ng-container matColumnDef="paymentDate">
        <th mat-header-cell *matHeaderCellDef>{{ 'payment.history.table.paymentDate' | translate }}</th>
        <td mat-cell *matCellDef="let payment"> {{ payment.paymentDate | date: 'mediumDate' }} </td>
      </ng-container>
  
      <!-- Amount Paid Column -->
      <ng-container matColumnDef="amountPaid">
        <th mat-header-cell *matHeaderCellDef>{{ 'payment.history.table.amountPaid' | translate }}</th>
        <td mat-cell *matCellDef="let payment" [ngClass]="{
          'paid': payment.status === 'paid',
          'partially-paid': payment.status === 'partiallyPaid',
          'unpaid': payment.status === 'unpaid'
        }"> {{ payment.amountPaid | currency:'DA' }} </td>
      </ng-container>

      <!-- Payment Status Column -->
      <ng-container matColumnDef="paymentStatus">
        <th mat-header-cell *matHeaderCellDef>{{ 'payment.history.table.paymentStatus' | translate }}</th>
        <td mat-cell *matCellDef="let payment"> {{ 'payment.history.status.' + payment.status | translate }} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="generatePdf()" [disabled]="!selectedSeries">{{ 'payment.history.actions.print' | translate }}</button>
    <button mat-button (click)="dialogRef.close()">{{ 'common.cancel' | translate }}</button>
  </mat-dialog-actions>
  