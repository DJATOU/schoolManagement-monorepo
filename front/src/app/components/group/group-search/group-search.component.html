<div class="group-search-container">
  <!-- TOPBAR (sticky) -->
  <div class="topbar">
    <div class="topbar-main">
      <app-list-header [count]="totalGroups" [entityName]="'groups'" [filterLabel]="'Show active only'"
        (filterChange)="onActiveFilterChange($event)">
      </app-list-header>

      <div class="topbar-actions">
        <!-- COMPACT PAGINATOR -->
        <div class="compact-paginator" *ngIf="!isLoading && filteredGroups.length > 0">
          <mat-paginator [length]="totalGroups" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
            [pageIndex]="currentPageIndex" (page)="changePage($event)" showFirstLastButtons>
          </mat-paginator>
        </div>

        <app-view-toggle [viewMode]="viewMode" (viewModeChange)="changeViewMode($event)">
        </app-view-toggle>
      </div>
    </div>
  </div>

  <!-- CONTENT (scrollable with infinite scroll) -->
  <div class="content-area" #contentArea (scroll)="onScroll($event)">
    <ng-container *ngIf="!isLoading && displayedGroups.length > 0">
      <div class="group-view" [ngClass]="viewMode === 'card' ? 'cards-grid' : 'list-view'">
        <ng-container *ngIf="viewMode === 'card'">
          <app-group-card *ngFor="let group of displayedGroups" [group]="group" [levels]="levels"
            [groupTypes]="groupTypes" class="fade-in"></app-group-card>
        </ng-container>
        <ng-container *ngIf="viewMode === 'list'">
          <app-group-list *ngFor="let group of displayedGroups" [group]="group" [levels]="levels"
            [groupTypes]="groupTypes" class="fade-in"></app-group-list>
        </ng-container>
      </div>

      <!-- Loading indicator for infinite scroll -->
      <div class="loading-more" *ngIf="isLoadingMore">
        <mat-spinner diameter="32"></mat-spinner>
        <span>Chargement...</span>
      </div>

      <!-- End of list indicator -->
      <div class="end-of-list" *ngIf="!hasMoreData && displayedGroups.length > 0">
        <span>Tous les groupes affichés ({{displayedGroups.length}})</span>
      </div>
    </ng-container>

    <ng-container *ngIf="isLoading">
      <div class="loading-state">
        <mat-spinner></mat-spinner>
        <p>Chargement des groupes...</p>
      </div>
    </ng-container>

    <ng-container *ngIf="!isLoading && filteredGroups.length === 0">
      <div class="empty-state">
        <mat-icon class="empty-icon">group_off</mat-icon>
        <p>Aucun groupe trouvé.</p>
      </div>
    </ng-container>
  </div>
</div>